{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import {Observable, Subscriber} from 'rxjs';\nimport {\n  Adapter,\n  AdapterFactory,\n  AdapterOpenOptions,\n  ScanParameters,\n  ConnectionOptions,\n  Device,\n  Service,\n  Characteristic\n} from 'pc-ble-driver-js';\n\nfunction toHexString(byteArray) {\n  return byteArray.map(function(byte) {\n    return ('0' + (byte & 0xFF).toString(16)).slice(-2);\n  }).join('');\n}\n\nexport class ScanError extends Error {\n  constructor(public driverError: any) {\n    super();\n  }\n}\n\nexport class ConnectError extends Error {\n  constructor(public driverError: any, public device: Device) {\n    super();\n  }\n};\n\nexport class DisconnectError extends Error {\n  constructor(public driverError: any, public device: Device) {\n    super();\n  }\n};\n\nexport class ServiceDiscoveryError extends Error {\n  constructor(public driverError: any, public device: Device) {\n    super();\n  }\n}\n\nexport class CharacteristicDiscoveryError extends Error {\n  constructor(public driverError: any, public service: Service) {\n    super();\n  }\n}\n\nexport class ReadCharacteristicError extends Error {\n  constructor(public driverError: any, public ch: Characteristic) {\n    super();\n  }\n}\n\nexport enum AdapterFactoryEventType {\n  Added,\n  Removed\n}\n\nexport interface AdapterEvent {\n  adapter: Adapter;\n  eventType: AdapterFactoryEventType;\n}\n\nexport function adapterFactoryObservable(\n  adapterFactory: AdapterFactory): Observable<AdapterEvent> {\n\n  return Observable.create((obs: Subscriber<AdapterEvent>) => {\n\n    function onAdded(adapter) {\n      obs.next({\n        adapter,\n        eventType: AdapterFactoryEventType.Added\n      });\n    }\n\n    function onRemoved(adapter) {\n      obs.next({\n        adapter,\n        eventType: AdapterFactoryEventType.Removed\n      });\n    }\n\n    adapterFactory.on('added', onAdded);\n    adapterFactory.on('removed', onRemoved);\n\n    return () => {\n      adapterFactory.removeListener('added', onAdded);\n      adapterFactory.removeListener('removed', onRemoved);\n    };\n  });\n}\n\nexport function openAdapterObservable(adapter: Adapter,\n  openOptions?: AdapterOpenOptions): Observable<Adapter> {\n\n  return Observable.create((obs: Subscriber<Adapter>) => {\n\n    adapter.open(openOptions, (error) => {\n      if (error) {\n        obs.error(error);\n        return;\n      }\n      obs.next(adapter);\n      obs.complete();\n    });\n\n    return () => {\n    };\n  });\n}\n\nexport function closeAdapterObservable(adapter: Adapter) {\n  return Observable.create((obs: Subscriber<Adapter>) => {\n\n    adapter.close((error) => {\n      if (error) {\n        obs.error(error);\n        return;\n      }\n      obs.next(adapter);\n      obs.complete();\n    });\n\n    return () => {\n    };\n  });\n}\n\nexport function startScanDevicesObservable(adapter: Adapter,\n  scanOptions: ScanParameters): Observable<Device> {\n\n  return Observable.create((obs: Subscriber<Device>) => {\n\n    function onDeviceDiscovered(device: Device) {\n      obs.next(device);\n    }\n\n    adapter.on('deviceDiscovered', onDeviceDiscovered);\n\n    adapter.startScan(scanOptions, (error) => {\n      if (error) {\n        obs.error(new ScanError(error));\n        return;\n      }\n    });\n\n    return () => {\n      adapter.removeListener('deviceDiscovered', onDeviceDiscovered);\n    };\n  });\n}\n\n\nexport function stopScanDevicesObservable(adapter: Adapter): Observable<void> {\n  return Observable.create((obs: Subscriber<void>) => {\n\n    adapter.getState((err, state) => {\n      if (state.scanning === true) {\n        adapter.stopScan((error) => {\n          if (error) {\n            obs.error(error);\n            return;\n          }\n          obs.next();\n          obs.complete();\n        });\n      } else {\n        obs.next();\n      }\n    });\n\n    return () => {\n\n    };\n  });\n}\n\nexport function discoverServicesObservable(adapter: Adapter, device: Device): Observable<Service[]> {\n  return Observable.create((obs: Subscriber<Service[]>) => {\n    adapter.getServices(device.instanceId, (err, services) => {\n      if (err) {\n        obs.error(new ServiceDiscoveryError(err, device));\n        return;\n      }\n      obs.next(services);\n      obs.complete();\n    });\n\n    return () => {\n    };\n  });\n}\n\nexport function discoverCharacteristicObservable(adapter: Adapter,\n  service: Service): Observable<Characteristic[]> {\n\n  return Observable.create((obs: Subscriber<Characteristic[]>) => {\n    adapter.getCharacteristics(service.instanceId, (err, chars) => {\n      if (err) {\n        obs.error(new CharacteristicDiscoveryError(err, service));\n        return;\n      }\n      obs.next(chars);\n      obs.complete();\n    });\n\n    return () => {\n    };\n  });\n}\n\nexport function readCharacteristicObservable(adapter: Adapter,\n  characteristic: Characteristic): Observable<String> {\n\n  return Observable.create((obs: Subscriber<string>) => {\n\n    adapter.readCharacteristicValue(characteristic.instanceId, (err, value) => {\n      if (err) {\n        obs.error(new ReadCharacteristicError(err, characteristic));\n        return;\n      }\n      obs.next(toHexString(value));\n      obs.complete();\n    });\n\n    return () => {\n    };\n  });\n}\n\nexport function connectDeviceObservable(adapter: Adapter, device: Device,\n  options: ConnectionOptions): Observable<Device> {\n\n  return Observable.create((obs: Subscriber<Device>) => {\n\n    function onDeviceConnected(connectedDevice) {\n      obs.next(connectedDevice);\n      obs.complete();\n    }\n\n    adapter.on('deviceConnected', onDeviceConnected);\n\n    adapter.connect(device.address, options, (err) => {\n      if (err) {\n        obs.error(new ConnectError(err, device));\n        return;\n      }\n    });\n\n    return () => {\n      adapter.removeListener('deviceConnected', onDeviceConnected);\n    };\n  });\n}\n\nexport function disconnectDeviceObservable(adapter: Adapter, device: Device): Observable<void> {\n\n  return Observable.create((obs: Subscriber<void>) => {\n    adapter.disconnect(device.instanceId, (err) => {\n      if (err) {\n        obs.error(new DisconnectError(err, device));\n        return;\n      }\n      obs.next();\n      obs.complete();\n    });\n\n    return () => {\n    };\n  });\n}\n"]}